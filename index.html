<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vote Counting Tool for Bangladesh Election</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f8f6f0;
      --paper: #fffef9;
      --border: #2c5282;
      --border-light: #a0aec0;
      --text: #1a202c;
      --text-muted: #4a5568;
      --accent: #2b6cb0;
      --accent-hover: #2c5282;
      --btn-bg: #e2e8f0;
      --header-bg: linear-gradient(135deg, #2c5282 0%, #2b6cb0 100%);
      --footer-bg: #edf2f7;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: var(--header-bg);
      color: #fff;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-logo {
      height: 48px;
      width: auto;
      max-width: 52px;
      object-fit: contain;
      border-radius: 4px;
    }

    .header-title {
      font-size: clamp(0.95rem, 2.5vw, 1.25rem);
      font-weight: 700;
      margin: 0;
    }

    .lang-toggle {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(255,255,255,0.2);
      border-radius: 9999px;
      padding: 2px;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .lang-toggle button {
      padding: 0.35rem 0.75rem;
      border: none;
      border-radius: 9999px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: rgba(255,255,255,0.9);
      transition: all 0.2s;
    }

    .lang-toggle button.active {
      background: #fff;
      color: var(--accent);
    }

    .lang-toggle button:not(.active):hover {
      background: rgba(255,255,255,0.15);
    }

    /* Body */
    .body {
      flex: 1;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .form-card {
      background: var(--paper);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 1.25rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }

    .form-meta {
      margin-bottom: 1.25rem;
    }

    .form-meta label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .form-meta input {
      width: 100%;
      max-width: 400px;
      padding: 0.4rem 0.5rem;
      border: 1px solid var(--border-light);
      border-radius: 4px;
      font-size: 1rem;
    }

    .form-meta .row {
      margin-bottom: 0.75rem;
    }

    /* Table wrapper */
    .table-wrap {
      overflow-x: auto;
      margin: 1rem 0;
      -webkit-overflow-scrolling: touch;
    }

    .main-table {
      width: 100%;
      min-width: 720px;
      border-collapse: collapse;
      font-size: clamp(0.75rem, 1.8vw, 0.9rem);
    }

    .main-table th,
    .main-table td {
      border: 1px solid var(--border-light);
      padding: 0.4rem 0.5rem;
      vertical-align: middle;
    }

    .main-table th {
      background: #e6f2ff;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
    }

    .main-table td {
      background: #fff;
    }

    .main-table tr.total-row td {
      background: #edf2f7;
      font-weight: 600;
    }

    .col-serial { width: 3rem; min-width: 2.5rem; text-align: center; }
    .col-name { min-width: 120px; }
    .col-symbol { width: 4rem; min-width: 3.5rem; }
    .col-valid, .col-challenged { width: 10.5rem; min-width: 9.5rem; }
    .col-total-valid { min-width: 160px; }

    /* Numeric input with +/- */
    .num-input-wrap {
      display: flex;
      align-items: stretch;
      width: 100%;
      min-width: 0;
    }

    .num-input-wrap .btn-pm {
      flex-shrink: 0;
      width: 1.75rem;
      min-width: 1.75rem;
      border: 1px solid var(--border-light);
      background: var(--btn-bg);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
    }

    .num-input-wrap .btn-pm:hover {
      background: #cbd5e0;
    }

    .num-input-wrap .btn-pm:first-child {
      border-radius: 4px 0 0 4px;
      border-right: 0;
    }

    .num-input-wrap .btn-pm:last-child {
      border-radius: 0 4px 4px 0;
      border-left: 0;
    }

    .num-input-wrap input {
      width: 4.5rem;
      min-width: 4rem;
      flex: 1;
      border: 1px solid var(--border-light);
      border-left: none;
      border-right: none;
      padding: 0.35rem 0.4rem;
      font-size: inherit;
      text-align: center;
    }

    .num-input-wrap input:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Read-only total cell */
    .cell-total-valid {
      font-size: 0.85em;
      white-space: nowrap;
    }

    .cell-total-valid .words {
      color: var(--text-muted);
      font-size: 0.9em;
    }

    .add-row-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 0.5rem;
    }

    .btn-add {
      padding: 0.4rem 0.9rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-add:hover {
      background: var(--accent-hover);
    }

    /* Summary fields below table */
    .summary-fields {
      margin-top: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
    }

    .summary-row label {
      flex: 1 1 200px;
      min-width: 0;
      font-size: 0.9rem;
      color: var(--text);
    }

    .summary-row .input-wrap {
      flex: 0 1 280px;
      min-width: 180px;
    }

    .summary-row .input-wrap.readonly {
      padding: 0.5rem 0.6rem;
      border: 1px solid var(--border-light);
      border-radius: 4px;
      background: #f7fafc;
      font-size: 1rem;
    }

    .summary-row .input-wrap.readonly .words {
      color: var(--text-muted);
      font-size: 0.9em;
    }

    /* Footer */
    .footer {
      background: var(--footer-bg);
      padding: 1rem;
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border-light);
    }

    input[type="text"],
    input[type="number"] {
      font-family: inherit;
    }

    .bn { font-family: 'Noto Sans Bengali', sans-serif; }

    @media (max-width: 768px) {
      .header {
        padding: 0.6rem 0.75rem;
      }
      .header-logo { height: 40px; }
      .body { padding: 0.75rem; }
      .form-card { padding: 1rem; }
      .main-table { font-size: 0.8rem; }
      .col-total-valid { min-width: 110px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-left">
      <img src="election_commission_logo.jpg" alt="Election Commission" class="header-logo">
      <h1 class="header-title" id="header-title">Vote Counting Tool for Bangladesh Election</h1>
    </div>
    <div class="lang-toggle">
      <button type="button" id="lang-en" class="active" aria-pressed="true">EN</button>
      <button type="button" id="lang-bn" aria-pressed="false">BN</button>
    </div>
  </header>

  <main class="body">
    <div class="form-card">
      <div class="form-meta">
        <div class="row">
          <label id="lbl-area">Electoral Area Number and Name</label>
          <input type="text" id="input-area" placeholder="">
        </div>
        <div class="row">
          <label id="lbl-center">Polling Center Number and Name</label>
          <input type="text" id="input-center" placeholder="">
        </div>
        <div class="row">
          <label id="lbl-voters">Total Voter Count</label>
          <input type="text" id="input-voters" placeholder="">
        </div>
      </div>

      <div class="add-row-bar">
        <button type="button" class="btn-add" id="btn-add-row">Add Another</button>
      </div>

      <div class="table-wrap">
        <table class="main-table" id="main-table">
          <thead>
            <tr>
              <th class="col-serial" id="th-serial">Serial No.</th>
              <th class="col-name" id="th-name">Contesting Candidate's Name</th>
              <th class="col-symbol" id="th-symbol">Symbol</th>
              <th class="col-valid" id="th-valid">Valid Votes<br><small>4(a)</small></th>
              <th class="col-challenged" id="th-challenged">Challenged Valid Votes<br><small>4(b)</small></th>
              <th class="col-total-valid" id="th-total-valid">Total Valid Votes (figures &amp; words)<br><small>5[4(a)+4(b)]</small></th>
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- Data rows injected by JS -->
          </tbody>
          <tbody id="total-body">
            <tr class="total-row">
              <td class="col-serial" id="td-total-label">Total</td>
              <td class="col-name"></td>
              <td class="col-symbol"></td>
              <td class="col-valid"></td>
              <td class="col-challenged"></td>
              <td class="col-total-valid cell-total-valid" id="grand-total-cell"><span class="figures">0</span> <span class="words">(zero)</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="summary-fields">
        <div class="summary-row">
          <label id="lbl-summary1">Total votes received by contesting candidates</label>
          <div class="input-wrap readonly" id="summary1-display"><span class="figures">0</span> <span class="words">(zero)</span></div>
        </div>
        <div class="summary-row">
          <label id="lbl-summary2">Number of invalid votes cancelled during counting</label>
          <div class="input-wrap">
            <div class="num-input-wrap">
              <button type="button" class="btn-pm" id="summary2-minus">−</button>
              <input type="text" id="summary2-input" value="0" inputmode="numeric">
              <button type="button" class="btn-pm" id="summary2-plus">+</button>
            </div>
          </div>
        </div>
        <div class="summary-row">
          <label id="lbl-summary3">Final Sum</label>
          <div class="input-wrap readonly" id="summary3-display"><span class="figures">0</span> <span class="words">(zero)</span></div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <p>Vote Counting Tool for Bangladesh Election — For official use</p>
  </footer>

  <script>
    (function () {
      'use strict';

      var lang = 'en';
      var labels = {
        en: {
          area: 'Electoral Area Number and Name',
          center: 'Polling Center Number and Name',
          voters: 'Total Voter Count',
          addAnother: 'Add Another',
          serial: 'Serial No.',
          name: "Contesting Candidate's Name",
          symbol: "Contesting Candidate's Symbol",
          valid: 'Valid Votes',
          challenged: 'Challenged Valid Votes',
          totalValid: 'Total Valid Votes (figures & words)',
          sub5: '5[4(a)+4(b)]',
          total: 'Total',
          summary1: 'Total votes received by contesting candidates',
          summary2: 'Number of invalid votes cancelled during counting',
          summary3: 'Final Sum'
        },
        bn: {
          area: 'নির্বাচনি এলাকার নম্বর ও নাম',
          center: 'ভোটকেন্দ্রের নম্বর ও নামঃ',
          voters: 'মোট ভোটার সংখ্যাঃ',
          addAnother: 'আরেকটি যুক্ত করুন',
          serial: 'ক্রমিক',
          name: 'প্রতিদ্বন্ধী প্রার্থীর নাম',
          symbol: 'প্রতিদ্বন্ধী প্রার্থীর প্রতীক',
          valid: 'বৈধ ভোট',
          challenged: 'আপত্তিকৃত বৈধ ভোট',
          totalValid: 'মোট বৈধ ভোট (অংকে ও কথায়)',
          sub5: '৫[৪(ক)+৪(খ)]',
          total: 'মোট',
          summary1: 'প্রতিদ্বন্ধী প্রার্থীগণ কর্তৃক প্রাপ্ত মোট ভোটের সংখ্যা',
          summary2: 'গণনাকালে বাতিলকৃত অবৈধ ভোটের সংখ্যা',
          summary3: 'চূড়ান্ত সমষ্টি'
        }
      };

      function numberToWordsEn(n) {
        n = Math.floor(Number(n)) || 0;
        if (n === 0) return 'zero';
        var ones = ['','one','two','three','four','five','six','seven','eight','nine','ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'];
        var tens = ['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];
        if (n < 20) return ones[n];
        if (n < 100) return tens[Math.floor(n/10)] + (n % 10 ? ' ' + ones[n%10] : '');
        if (n < 1000) return ones[Math.floor(n/100)] + ' hundred' + (n % 100 ? ' ' + numberToWordsEn(n % 100) : '');
        if (n < 100000) return numberToWordsEn(Math.floor(n/1000)) + ' thousand' + (n % 1000 ? ' ' + numberToWordsEn(n % 1000) : '');
        if (n < 10000000) return numberToWordsEn(Math.floor(n/100000)) + ' lakh' + (n % 100000 ? ' ' + numberToWordsEn(n % 100000) : '');
        return numberToWordsEn(Math.floor(n/10000000)) + ' crore' + (n % 10000000 ? ' ' + numberToWordsEn(n % 10000000) : '');
      }

      function numberToWordsBn(n) {
        n = Math.floor(Number(n)) || 0;
        if (n === 0) return 'শূন্য';
        var ones = ['','এক','দুই','তিন','চার','পাঁচ','ছয়','সাত','আট','নয়','দশ','এগারো','বারো','তেরো','চৌদ্দ','পনেরো','ষোল','সতেরো','আঠারো','উনিশ'];
        var tens = ['','','কুড়ি','ত্রিশ','চল্লিশ','পঞ্চাশ','ষাট','সত্তর','আশি','নব্বই'];
        if (n < 20) return ones[n];
        if (n < 100) return tens[Math.floor(n/10)] + (n % 10 ? ' ' + ones[n%10] : '');
        if (n < 1000) return ones[Math.floor(n/100)] + 'শত' + (n % 100 ? ' ' + numberToWordsBn(n % 100) : '');
        if (n < 100000) return numberToWordsBn(Math.floor(n/1000)) + ' হাজার' + (n % 1000 ? ' ' + numberToWordsBn(n % 1000) : '');
        if (n < 10000000) return numberToWordsBn(Math.floor(n/100000)) + ' লক্ষ' + (n % 100000 ? ' ' + numberToWordsBn(n % 100000) : '');
        return numberToWordsBn(Math.floor(n/10000000)) + ' কোটি' + (n % 10000000 ? ' ' + numberToWordsBn(n % 10000000) : '');
      }

      function wordsFor(n) {
        return lang === 'bn' ? numberToWordsBn(n) : numberToWordsEn(n);
      }

      function serialText(num) {
        return lang === 'bn' ? 'ক্রমিকঃ ' + toBengaliDigit(num) : String(num);
      }

      var bnDigits = '০১২৩৪৫৬৭৮৯';
      var enDigits = '0123456789';

      function toBengaliDigit(n) {
        var s = String(n);
        return s.replace(/[0-9]/g, function (d) { return bnDigits[Number(d)]; });
      }

      function parseNumStr(str) {
        var s = String(str || '0').replace(/[০-৯]/g, function (c) { return bnDigits.indexOf(c); }).replace(/[^0-9]/g, '');
        return s === '' ? '0' : s;
      }

      function digitsToLang(str, toBn) {
        var num = parseNumStr(str);
        return toBn ? toBengaliDigit(parseInt(num, 10)) : num;
      }

      function convertAllNumericInputsToLang() {
        tbody.querySelectorAll('input[data-col="valid"], input[data-col="challenged"]').forEach(function (input) {
          input.value = digitsToLang(input.value, lang === 'bn');
        });
        document.getElementById('summary2-input').value = digitsToLang(document.getElementById('summary2-input').value, lang === 'bn');
      }

      function updateAllSerialCells() {
        var rows = tbody.querySelectorAll('tr');
        rows.forEach(function (tr, i) {
          var first = tr.querySelector('.col-serial');
          if (first) first.textContent = serialText(i + 1);
        });
      }

      function setLanguage(l) {
        lang = l;
        document.getElementById('lang-en').classList.toggle('active', l === 'en');
        document.getElementById('lang-bn').classList.toggle('active', l === 'bn');
        document.body.classList.toggle('bn', l === 'bn');
        document.documentElement.lang = l === 'bn' ? 'bn' : 'en';

        document.getElementById('lbl-area').textContent = labels[lang].area;
        document.getElementById('lbl-center').textContent = labels[lang].center;
        document.getElementById('lbl-voters').textContent = labels[lang].voters;
        document.getElementById('btn-add-row').textContent = labels[lang].addAnother;
        document.getElementById('th-serial').innerHTML = labels[lang].serial;
        document.getElementById('th-name').textContent = labels[lang].name;
        document.getElementById('th-symbol').textContent = labels[lang].symbol;
        document.getElementById('th-valid').innerHTML = labels[lang].valid + '<br><small>' + (l === 'bn' ? '৪(ক)' : '4(a)') + '</small>';
        document.getElementById('th-challenged').innerHTML = labels[lang].challenged + '<br><small>' + (l === 'bn' ? '৪(খ)' : '4(b)') + '</small>';
        document.getElementById('th-total-valid').innerHTML = labels[lang].totalValid + '<br><small>' + labels[lang].sub5 + '</small>';
        document.getElementById('td-total-label').textContent = labels[lang].total;
        document.getElementById('lbl-summary1').textContent = labels[lang].summary1;
        document.getElementById('lbl-summary2').textContent = labels[lang].summary2;
        document.getElementById('lbl-summary3').textContent = labels[lang].summary3;
        document.getElementById('header-title').textContent = l === 'bn' ? 'বাংলাদেশ নির্বাচন ভোট গণনার সরঞ্জাম' : 'Vote Counting Tool for Bangladesh Election';

        updateAllSerialCells();
        convertAllNumericInputsToLang();
        refreshAllTotals();
      }

      var rowCount = 0;
      var tbody = document.getElementById('table-body');

      function makeNumInput(className, rowIndex, col) {
        var wrap = document.createElement('div');
        wrap.className = 'num-input-wrap';
        var minus = document.createElement('button');
        minus.type = 'button';
        minus.className = 'btn-pm';
        minus.textContent = '−';
        var input = document.createElement('input');
        input.type = 'text';
        input.setAttribute('inputmode', 'numeric');
        input.value = lang === 'bn' ? '০' : '0';
        input.dataset.row = rowIndex;
        input.dataset.col = col;
        var plus = document.createElement('button');
        plus.type = 'button';
        plus.className = 'btn-pm';
        plus.textContent = '+';

        function updateRowTotal() {
          var v = parseInt(parseNumStr(input.value), 10) || 0;
          var otherCol = col === 'valid' ? 'challenged' : 'valid';
          var otherInput = input.closest('tr').querySelector('input[data-col="' + otherCol + '"]');
          var other = parseInt(parseNumStr(otherInput && otherInput.value), 10) || 0;
          var sum = v + other;
          var row = input.closest('tr');
          var totalCell = row.querySelector('.row-total-cell');
          if (totalCell) {
            totalCell.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(sum) : sum;
            totalCell.querySelector('.words').textContent = '(' + wordsFor(sum) + ')';
          }
          grandTotal();
        }

        minus.addEventListener('click', function () {
          var v = Math.max(0, (parseInt(parseNumStr(input.value), 10) || 0) - 1);
          input.value = lang === 'bn' ? toBengaliDigit(v) : String(v);
          updateRowTotal();
        });
        plus.addEventListener('click', function () {
          var v = (parseInt(parseNumStr(input.value), 10) || 0) + 1;
          input.value = lang === 'bn' ? toBengaliDigit(v) : String(v);
          updateRowTotal();
        });
        input.addEventListener('input', function () {
          if (lang === 'bn') {
            this.value = this.value.replace(/[0-9]/g, function (d) { return bnDigits[Number(d)]; });
            this.value = this.value.replace(/[^০-৯]/g, '');
          } else {
            this.value = this.value.replace(/[^0-9]/g, '');
          }
          if (this.value === '') this.value = lang === 'bn' ? '০' : '0';
          updateRowTotal();
        });

        wrap.appendChild(minus);
        wrap.appendChild(input);
        wrap.appendChild(plus);
        return wrap;
      }

      function grandTotal() {
        var cells = tbody.querySelectorAll('.row-total-cell .figures');
        var sum = 0;
        cells.forEach(function (el) {
          sum += parseInt(parseNumStr(el.textContent), 10) || 0;
        });
        var grandCell = document.getElementById('grand-total-cell');
        grandCell.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(sum) : sum;
        grandCell.querySelector('.words').textContent = '(' + wordsFor(sum) + ')';

        var s1 = document.getElementById('summary1-display');
        s1.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(sum) : sum;
        s1.querySelector('.words').textContent = '(' + wordsFor(sum) + ')';

        var s2Input = document.getElementById('summary2-input');
        var invalid = parseInt(parseNumStr(s2Input.value), 10) || 0;
        var finalSum = sum + invalid;
        var s3 = document.getElementById('summary3-display');
        s3.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(finalSum) : finalSum;
        s3.querySelector('.words').textContent = '(' + wordsFor(finalSum) + ')';
      }

      function refreshAllTotals() {
        tbody.querySelectorAll('tr').forEach(function (tr) {
          var validIn = tr.querySelector('input[data-col="valid"]');
          var chalIn = tr.querySelector('input[data-col="challenged"]');
          var totalCell = tr.querySelector('.row-total-cell');
          if (validIn && chalIn && totalCell) {
            var v = parseInt(parseNumStr(validIn.value), 10) || 0;
            var c = parseInt(parseNumStr(chalIn.value), 10) || 0;
            totalCell.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(v + c) : (v + c);
            totalCell.querySelector('.words').textContent = '(' + wordsFor(v + c) + ')';
          }
        });
        grandTotal();
      }

      function addRow() {
        rowCount += 1;
        var tr = document.createElement('tr');
        tr.dataset.rowIndex = rowCount;
        var serial = document.createElement('td');
        serial.className = 'col-serial';
        serial.textContent = serialText(rowCount);
        tr.appendChild(serial);

        var nameCell = document.createElement('td');
        nameCell.className = 'col-name';
        var nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.style.width = '100%';
        nameInput.style.padding = '0.35rem';
        nameInput.style.border = '1px solid var(--border-light)';
        nameInput.style.borderRadius = '4px';
        nameCell.appendChild(nameInput);
        tr.appendChild(nameCell);

        var symCell = document.createElement('td');
        symCell.className = 'col-symbol';
        var symInput = document.createElement('input');
        symInput.type = 'text';
        symInput.style.width = '100%';
        symInput.style.padding = '0.35rem';
        symInput.style.border = '1px solid var(--border-light)';
        symInput.style.borderRadius = '4px';
        symCell.appendChild(symInput);
        tr.appendChild(symCell);

        var validCell = document.createElement('td');
        validCell.className = 'col-valid';
        validCell.appendChild(makeNumInput('valid', rowCount, 'valid'));
        tr.appendChild(validCell);

        var chalCell = document.createElement('td');
        chalCell.className = 'col-challenged';
        chalCell.appendChild(makeNumInput('challenged', rowCount, 'challenged'));
        tr.appendChild(chalCell);

        var totalCell = document.createElement('td');
        totalCell.className = 'col-total-valid cell-total-valid row-total-cell';
        totalCell.innerHTML = '<span class="figures">' + (lang === 'bn' ? '০' : '0') + '</span> <span class="words">(' + (lang === 'bn' ? 'শূন্য' : 'zero') + ')</span>';
        tr.appendChild(totalCell);

        tbody.appendChild(tr);
      }

      document.getElementById('btn-add-row').addEventListener('click', function () {
        addRow();
      });

      document.getElementById('summary2-minus').addEventListener('click', function () {
        var el = document.getElementById('summary2-input');
        var v = Math.max(0, (parseInt(parseNumStr(el.value), 10) || 0) - 1);
        el.value = lang === 'bn' ? toBengaliDigit(v) : String(v);
        updateSummary3();
      });
      document.getElementById('summary2-plus').addEventListener('click', function () {
        var el = document.getElementById('summary2-input');
        var v = (parseInt(parseNumStr(el.value), 10) || 0) + 1;
        el.value = lang === 'bn' ? toBengaliDigit(v) : String(v);
        updateSummary3();
      });
      document.getElementById('summary2-input').addEventListener('input', function () {
        if (lang === 'bn') {
          this.value = this.value.replace(/[0-9]/g, function (d) { return bnDigits[Number(d)]; });
          this.value = this.value.replace(/[^০-৯]/g, '');
        } else {
          this.value = this.value.replace(/[^0-9]/g, '');
        }
        if (this.value === '') this.value = lang === 'bn' ? '০' : '0';
        updateSummary3();
      });

      function updateSummary3() {
        var s1Figs = document.querySelector('#grand-total-cell .figures');
        var totalVotes = parseInt(parseNumStr(s1Figs && s1Figs.textContent), 10) || 0;
        var invalid = parseInt(parseNumStr(document.getElementById('summary2-input').value), 10) || 0;
        var finalSum = totalVotes + invalid;
        var s3 = document.getElementById('summary3-display');
        s3.querySelector('.figures').textContent = lang === 'bn' ? toBengaliDigit(finalSum) : finalSum;
        s3.querySelector('.words').textContent = '(' + wordsFor(finalSum) + ')';
      }

      document.getElementById('lang-en').addEventListener('click', function () { setLanguage('en'); });
      document.getElementById('lang-bn').addEventListener('click', function () { setLanguage('bn'); });

      setLanguage('en');
      addRow();
    })();
  </script>
</body>
</html>
